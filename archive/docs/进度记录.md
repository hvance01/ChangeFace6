# é¡¹ç›®è¿›åº¦è®°å½• - 2025-11-13

## âœ… ä»Šæ—¥å®Œæˆçš„å·¥ä½œ

### 1. å®ŒæˆæŠ€æœ¯è°ƒç ” âœ…
- è§†é¢‘æ¢è„¸æ–¹æ¡ˆè°ƒç ”ï¼ˆReplicate APIï¼‰
- æŠ€æœ¯æ ˆé€‰æ‹©ï¼ˆStreamlit + Pythonï¼‰
- äº‘éƒ¨ç½²æ–¹æ¡ˆï¼ˆé˜¿é‡Œäº‘ï¼‰
- æ–‡æ¡£ï¼š`æ–¹æ¡ˆè°ƒç ”æŠ¥å‘Š.md`, `äº‘éƒ¨ç½²æ–¹æ¡ˆå¯¹æ¯”.md`, `Streamlitå¿«é€ŸDemoæ–¹æ¡ˆ.md`

### 2. æ­å»ºå®Œæ•´é¡¹ç›® âœ…
**é¡¹ç›®ç»“æ„:**
```
ChangeFace3/
â”œâ”€â”€ app.py                    # Streamlit ä¸»åº”ç”¨
â”œâ”€â”€ config.py                 # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt          # Python ä¾èµ–
â”œâ”€â”€ .env                     # API Token (å·²é…ç½®)
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ face_swap.py         # æ¢è„¸ API è°ƒç”¨
â”‚   â””â”€â”€ file_handler.py      # æ–‡ä»¶å¤„ç†
â”œâ”€â”€ input2/                  # æµ‹è¯•æ•°æ®
â”‚   â”œâ”€â”€ target.jpg           # æµ‹è¯•ç…§ç‰‡
â”‚   â””â”€â”€ target.mp4           # æµ‹è¯•è§†é¢‘
â””â”€â”€ output/
    â””â”€â”€ result_video.mp4     # âœ… æˆåŠŸç”Ÿæˆçš„æ¢è„¸è§†é¢‘
```

### 3. è°ƒè¯• Replicate API âœ…
**é—®é¢˜ä¸è§£å†³:**
- âŒ åˆå§‹æ¨¡å‹è·¯å¾„é”™è¯¯ (404)
- âœ… æ›´æ–°ä¸ºæ­£ç¡®æ¨¡å‹: `okaris/roop:8c1e100e...`
- âœ… å¤„ç† generator è¿”å›å€¼
- âœ… æˆåŠŸç”Ÿæˆæ¢è„¸è§†é¢‘

**æµ‹è¯•è„šæœ¬:**
- `test_api.py` - API è°ƒç”¨æµ‹è¯•
- `test_backend.py` - åç«¯é€»è¾‘æµ‹è¯•

### 4. ç”Ÿæˆæµ‹è¯•è§†é¢‘ âœ…
**æˆåŠŸæ¡ˆä¾‹:**
- è¾“å…¥: input2/target.jpg + input2/target.mp4
- è¾“å‡º: output/result_video.mp4 (4.6 MB)
- URL: https://replicate.delivery/yhqm/0Kxfd3H5op2YPiFw7U1tRSQCSXEHJjkfRjeYYJTHXpffBKHtC/swapped-tmpfnp044itdownload.mp4

### 5. Streamlit åº”ç”¨ âš ï¸
**çŠ¶æ€:** åŸºæœ¬åŠŸèƒ½å®Œæˆï¼ŒUI æ˜¾ç¤ºé—®é¢˜å·²ä¿®å¤
- âœ… æ–‡ä»¶ä¸Šä¼ 
- âœ… API è°ƒç”¨
- âœ… ç»“æœä¸‹è½½é“¾æ¥
- âš ï¸ æ˜¾ç¤ºè§†é¢‘é¢„è§ˆæ”¹ä¸ºåªæ˜¾ç¤ºä¸‹è½½é“¾æ¥ï¼ˆå·²ä¿®å¤ï¼‰

---

## ğŸ”§ æœ€åä¿®å¤çš„é—®é¢˜

### é”™è¯¯ä¿¡æ¯:
```
RuntimeError: Invalid binary data format: <class 'replicate.helpers.FileOutput'>
```

### è§£å†³æ–¹æ¡ˆ:
å°† `st.video(result_url)` æ”¹ä¸ºåªæ˜¾ç¤ºä¸‹è½½é“¾æ¥ï¼Œå› ä¸º `result_url` æ˜¯ `FileOutput` å¯¹è±¡ï¼Œéœ€è¦è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚

**å·²ä¿®æ”¹æ–‡ä»¶:** `app.py` (ç¬¬ 158-176 è¡Œ)

---

## ğŸ“‹ æ˜å¤©å¾…åŠäº‹é¡¹

### ä¼˜å…ˆçº§ P0 (å¿…é¡»å®Œæˆ)
- [ ] æµ‹è¯• Streamlit åº”ç”¨å®Œæ•´æµç¨‹
  - [ ] è®¿é—® http://localhost:8501
  - [ ] ä¸Šä¼ æ–‡ä»¶æµ‹è¯•
  - [ ] éªŒè¯ä¸‹è½½é“¾æ¥æ­£å¸¸å·¥ä½œ

- [ ] ä¿®å¤ Streamlit è­¦å‘Š
  - [ ] å°† `use_container_width=True` æ”¹ä¸º `width='stretch'`
  - [ ] æœç´¢æ‰€æœ‰ä½¿ç”¨ä½ç½®å¹¶æ›¿æ¢

### ä¼˜å…ˆçº§ P1 (é‡è¦)
- [ ] ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
  - [ ] æ·»åŠ å¤„ç†è¿›åº¦ç™¾åˆ†æ¯”æ˜¾ç¤º
  - [ ] æ”¹è¿›é”™è¯¯æç¤ºä¿¡æ¯
  - [ ] æ·»åŠ è§†é¢‘é¢„è§ˆç¼©ç•¥å›¾ï¼ˆå¯é€‰ï¼‰

- [ ] æ·»åŠ åŠŸèƒ½
  - [ ] æ”¯æŒå¤šç§è§†é¢‘æ ¼å¼
  - [ ] æ·»åŠ å¤„ç†å†å²è®°å½•
  - [ ] æ‰¹é‡å¤„ç†åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

### ä¼˜å…ˆçº§ P2 (å¦‚æœ‰æ—¶é—´)
- [ ] å‡†å¤‡éƒ¨ç½²
  - [ ] åˆ›å»º Dockerfile
  - [ ] ç¼–å†™éƒ¨ç½²è„šæœ¬
  - [ ] é˜¿é‡Œäº‘ç¯å¢ƒå‡†å¤‡

- [ ] æ–‡æ¡£å®Œå–„
  - [ ] æ›´æ–° README.md
  - [ ] æ·»åŠ ä½¿ç”¨æˆªå›¾
  - [ ] ç¼–å†™æ•…éšœæ’æŸ¥æŒ‡å—

---

## ğŸ› å·²çŸ¥é—®é¢˜

1. **Streamlit åºŸå¼ƒè­¦å‘Š**
   - `use_container_width` å°†åœ¨ 2025-12-31 åç§»é™¤
   - éœ€è¦æ›¿æ¢ä¸º `width='stretch'` æˆ– `width='content'`
   - ä½ç½®: app.py å¤šå¤„

2. **è§†é¢‘é¢„è§ˆ** (å·²è§£å†³)
   - ~~æ— æ³•ç›´æ¥é¢„è§ˆ FileOutput å¯¹è±¡~~
   - âœ… æ”¹ä¸ºåªæ˜¾ç¤ºä¸‹è½½é“¾æ¥

---

## ğŸ’¡ æŠ€æœ¯è¦ç‚¹è®°å½•

### Replicate API è°ƒç”¨
```python
# æ­£ç¡®çš„æ¨¡å‹è·¯å¾„ï¼ˆåŒ…å«ç‰ˆæœ¬å“ˆå¸Œï¼‰
model = "okaris/roop:8c1e100ecabb3151cf1e6c62879b6de7a4b84602de464ed249b6cff0b86211d8"

# è¿”å›å€¼æ˜¯ generatorï¼Œéœ€è¦è½¬æ¢ä¸º list
output = replicate.run(model, input={...})
result_list = list(output)  # è·å–å®é™…ç»“æœ
result_url = result_list[0]  # å–ç¬¬ä¸€ä¸ªå…ƒç´ 
```

### æˆæœ¬ä¿¡æ¯
- API è°ƒç”¨: $0.089/æ¬¡ (çº¦ Â¥0.6)
- å¤„ç†æ—¶é—´: çº¦ 60-90 ç§’
- ä¸é™è§†é¢‘é•¿åº¦

---

## ğŸ“Š æµ‹è¯•æ•°æ®

### æˆåŠŸæ¡ˆä¾‹
| æµ‹è¯• | çŠ¶æ€ | è¾“å…¥ | è¾“å‡º | è€—æ—¶ |
|------|------|------|------|------|
| test_api.py | âœ… | target.jpg + target.mp4 | result_video.mp4 | ~70ç§’ |
| test_backend.py | âœ… | target.jpg + target.mp4 | URL | ~65ç§’ |

---

## ğŸ”‘ é‡è¦é…ç½®

### .env æ–‡ä»¶
```bash
REPLICATE_API_TOKEN=r8_e1XvmiCXW4rGv2b91Ju7l3ePXqXxZ7M3eEWTe
```

### æ¨¡å‹é…ç½® (config.py)
```python
FACE_SWAP_MODEL = "okaris_roop"
API_CONFIGS = {
    "okaris_roop": {
        "model": "okaris/roop:8c1e100e...",
        "cost": 0.089
    }
}
```

---

## ğŸ“ é‡è¦æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒä»£ç 
- `app.py` - Streamlit ä¸»åº”ç”¨ (å·²ä¿®å¤æ˜¾ç¤ºé—®é¢˜)
- `utils/face_swap.py` - API è°ƒç”¨é€»è¾‘ (å·²æµ‹è¯•é€šè¿‡)
- `config.py` - é…ç½®æ–‡ä»¶ (æ¨¡å‹è·¯å¾„å·²æ›´æ–°)

### æµ‹è¯•è„šæœ¬
- `test_api.py` - ç‹¬ç«‹ API æµ‹è¯•
- `test_backend.py` - åç«¯å‡½æ•°æµ‹è¯•

### æ–‡æ¡£
- `æ–¹æ¡ˆè°ƒç ”æŠ¥å‘Š.md` - å®Œæ•´æŠ€æœ¯è°ƒç ”
- `äº‘éƒ¨ç½²æ–¹æ¡ˆå¯¹æ¯”.md` - éƒ¨ç½²æ–¹æ¡ˆ
- `æµ‹è¯•æ€»ç»“.md` - ä»Šæ—¥æµ‹è¯•æ€»ç»“
- `README.md` - é¡¹ç›®è¯´æ˜

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨å‘½ä»¤

### å¯åŠ¨åº”ç”¨
```bash
cd /home/hvance01/ChangeFace3
source venv/bin/activate
streamlit run app.py
```

### æµ‹è¯• API
```bash
python test_api.py
```

### æµ‹è¯•åç«¯
```bash
python test_backend.py
```

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼ŒæŸ¥çœ‹ä»¥ä¸‹æ–‡æ¡£:
- æ•…éšœæ’æŸ¥: `README.md`
- API æµ‹è¯•: `test_api.py`
- æ—¥å¿—æ–‡ä»¶: `streamlit.log`

---

**è®°å½•æ—¶é—´:** 2025-11-13 22:00
**ä¸‹æ¬¡å¯åŠ¨:** æ˜å¤©ç»§ç»­ä¼˜åŒ–å’Œæµ‹è¯•
**é¡¹ç›®çŠ¶æ€:** âœ… æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼Œå¾…ä¼˜åŒ– UI å’Œéƒ¨ç½²
